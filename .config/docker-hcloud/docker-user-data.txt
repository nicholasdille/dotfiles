#!/bin/bash

apt-get update
apt-get -y install bash curl jq make

curl -fL https://get.docker.com | sh

groupadd --gid "${GROUP_ID}" "${GROUP_NAME}"
useradd --create-home --shell "${USER_SHELL}" --uid "${USER_ID}" --gid "${GROUP_NAME}" --groups docker "${USER_NAME}"

# k3s
curl -s https://api.github.com/repos/rancher/k3s/releases/latest | \
    jq --raw-output '.assets[] | select(.name == "k3s") | .browser_download_url' | \
    xargs curl -sLfo /usr/local/bin/k3s
chmod +x /usr/local/bin/k3s

# k3d
curl -s https://raw.githubusercontent.com/rancher/k3d/master/install.sh | bash

# kind
curl -s https://api.github.com/repos/kubernetes-sigs/kind/releases/latest | \
        jq --raw-output '.assets[] | select(.name == "kind-linux-amd64") | .browser_download_url' | \
            xargs curl -sLfo /usr/local/bin/kind
chmod +x /usr/local/bin/kind

